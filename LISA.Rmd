---
title: "Identificación de complejos industriales con LISA"
author: "Jaime A. Prudencio-Vázquez"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: cerulean
    toc: yes
    toc_float: true
    highlight: pygments
bibliography: aglomeraciones.bib
csl: regional-science-and-urban-economics.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE,message = FALSE)
```
## Introducción

En este documento se expone el procedimiento para la identificación de  cadenas productivas territorializadas. La propuesta recurre al cálculo de coeficientes de autocorrelación espacial local, con base en la propuesta de Feser y Bergman [-@Feser-etal2005], adaptada a partir de las consideraciones de Anselin [-@Anselin2020local2] sobre la evaluación de la significancia de dichos estadísticos.

Así pues, el objetivo es identificar espacialmente, a nivel municipal, las cadenas productivas industriales identificadas a través del método Feser y Bergman [-@Feser2000] que fueron resultado del análisis por componentes principales de los patrones de compras y ventas de la Matriz de Insumo Producto de México de 2013 [@INEGI2018cn] a nivel rama de actividad clasificada según el Sistema de Clasificación Industrial de América de Norte [@INEGI2018scian].

Con el análisis por componentes principales propuesto por Feser y Bergman (2000), se identificaron 9 cadenas productivas industriales: Metalmecánica, Química, Eléctrico-electrónica, Textiles, confección y prendas de vestir, Construcción, Autotransportes, Papel e impresión, Plásticos y fibras sintéticas y Muebles y productos de madera. Los subsectores con mayor vinculación entre sí que integran cada una de las cadenas productias aparecen en la tabla 1.


| Cadena productiva                        	| Ramas más fuertemente vinculadas                                                                                                    	|
|------------------------------------------	|-------------------------------------------------------------------------------------------------------------------------------------	|
| Metalmecánica.                           	| 3327, 3312, 3315, 3329, 3328, 3362, 3322, 3311, 3365, 3335, 3334, 3324, 3366, 3323, 3352, 3325, 3321, 3339, 8113, 3331, 3313, 4889. 	|
| Química.                                 	| 3256, 3252, 3259, 3253, 2111, 5621, 3255, 3254, 3251, 3121, 3272.                                                                   	|
| Eléctrico-electrónica.                   	| 3344, 3342, 3341, 3333, 5172, 3343, 3345, 3351, 3332, 3359, 3353, 5171, 8112, 4885.                                                 	|
| Textiles, confección y prendas de vestir 	| 3141, 3151, 3159, 3152, 3149, 3133, 3132, 3379, 3169, 3391, 3162.                                                                   	|
| Construcción.                            	| 2379, 2372, 2361, 2362, 2381, 2371, 3273, 2389, 2373, 3271, 3279.                                                                   	|
| Autotransportes.                         	| 3361, 8111, 3369, 5321, 3363, 8114.                                                                                                 	|
| Papel e impresión.                       	| 3222, 3221, 3231, 5615, 5619, 8129, 5613.                                                                                           	|
| Plásticos y fibras sintéticas.           	| 3261, 3346, 3262, 3399, 3131.                                                                                                       	|
| Muebles y productos de madera.           	| 3372, 3326, 3212, 3219, 3371.                                                                                                       	|
: Tabla 1: Cadenas productivas identificadas.

Así pues, se trata de identificar los municipios donde dichas cadenas tienen presencia.

## Método

La propuesta para la identificación de  cadenas productivas territorializadas recurre al cálculo de coeficientes de autocorrelación espacial local, con base en la propuesta de Feser y Bergman [-@Feser-etal2005], adaptada a partir de las consideraciones de Anselin [-@Anselin2020local2]. Así pues, el objetivo es ubicar espacialmente las cadenas productivas industriales halladas a través del método Feser y Bergman [-@Feser2000] que fueron resultado del PCA, expuesto en el apartado anterior.  

Siguiendo las ideas de Feser et al. [-@Feser-etal2005] y González Villarreal et al. (2017), quienes proponen usar el estadístico de asociación espacial local de Getis-Ord ($G_i^*$) [@Getis1992], aquí más bien se propone el uso del estadistico de asociación espacial local de Moran, propuesto originalmente por Anselin [-@Anselin1995] y que tiene la forma de:

$$
I_i = c \cdot z_i \sum_j w_{ij} z_j
$$

La notación anterior corresponde a Anselin [-@Anselin2020local2], en ella $I_i$ es el estadístico de asociación espacial local de Moran, $z_i$ y $z_j$ corresponde al valor de la variable en la unidad territorial $i$ y $j$, que usualmente es el empleo, en términos estandarizados, en tanto, $w_{ij}$ es cada uno de los elementos de la matriz de pesos espaciales estandarizada por fila y, finalmente, $c$ corresponde a una constante dada por $\sum_i z_i^2$, que no es otra cosa que la suma del valor de la variable estandarizada.

El $I_i$ puede  ser representado en mapas de agrupaciones con cuatro categorías de municipios: i) agrupamientos de municipios con altos valores en la variable utilizada rodeados de unidades territoriales vecinas también con valores altos (agrupamientos Alto-Alto); ii) agrupamientos de unidades territoriales con valores bajos en la variable rodeados de vecinos con esta misma característica (agrupamientos Bajo-Bajo); iii) agrupamientos de unidades territoriales con valores bajos rodeados de vecinos con valores altos (agrupamientos Bajo-Alto); y iv) agrupamientos de unidades territoriales con un conteo alto de la variable de interés rodeados de municipios con un bajo conteo (agrupamientos Alto-Bajo).  

Cuando aquí se dece "alto" o "bajo" es en términos relativos, es decir, valores bajos o altos en el rango de la información utilizada. Las dos últimas categorías, los agrupamientos Bajo-Alto y Alto-Bajo, identifican unidades territoriales  como observaciones espaciales atípicas o _outliers_ espaciales.

Para evitar sobredimensionar la importancia del empleo u ocupación en los municipios más grandes en términos de su empleo absoluto con independencia del papel que éste juegue en la cadena productiva [@GonzalezVillareal2017, p. 6; @Feser-etal2005, p. 403], el índice $I_i$ se construye usando como variable los errores ($u_i$) de una regresión lineal estimada con mínimos cuadrados ordinarios del empleo de cada una de las cadenas productivas en cada municipio sobre el empleo total de dicho municipio ^[Una exposición más detallada de esta consideración puede consultarse en Feser et al. [-@Feser-etal2005].], es decir:

$$
emp_i=\beta_0+\beta_1empCPi+u_i
$$

Donde $emp_i$ es el empleo total del municipio $i$, $empCPi$ corresponde al empleo de la cadena productiva considerada en el municipio $i$. El enfoque de Feser et al. (2005) y Villarreal et al. (2017) tiene algunas debilidades, mismas que a continuación se enuncian, así como una propuesta para subsanarlas en este trabajo. 

### Diferencias con los enfoques previos 

Con base en la información arrojada por el $I_i$ es posible identificar, de acuerdo a su significancia estadística individual, qué unidades territoriales integran complejos industriales. En contraste con el enfoque original de Feser y Bergman (2005) y el usado para México por Villarreal et al. (2017) en donde el índice utilizado, el Getis-Ord, sólo clasifica a los municipios en dos grupos, alto y bajo, recurrir al estadístico de asociación espacial local de Moran permite categorizar con mayor detalle las unidades territoriales e identificar  observaciones espaciales atípicas. Así, en este trabajo las unidades territoriales que pertenezcan a la categoría Alto-Alto serán los que integren los complejos industriales.  

Por otro lado, son de particular interés los municipios identificados como observaciones atípicas espaciales del tipo Alto-Bajo que, sin formar parte de los complejos identificados, pueden constituirse en ellos a partir de política pública. Los municipios ubicados en el agrupamiento Alto-Bajo son unidades territoriales con un valor alto de la variable que están rodeados de otras con valores bajos, por lo que incentivar la localización de cadenas de proveedores en estos ellas y en sus vecinas puede tener efectos positivos en el crecimiento del conjunto de unidades territoriales al aprovecharse los efectos de arrastre y las economías de aglomeración.

Respecto al criterio para la selección de las unidades territoriales de los complejos industriales, en el trabajo de Feser y Bergman (2005) y Villarreal et al. (2017), se asume que el estadístico de asociación espacial local sigue una distribución normal estándar y, con arreglo a ello, se selecciona a los municipios que integran el complejo industrial cuando el valor del indice, en términos estandarizados, es mayor a 1.96. En la práctica, este enfoque tiene algunas debilidades cuando, en efecto, el estadístico calculado no sigue dicha distribución.

En este trabajo, para la selección de los municipios que integran cada complejo industrial, se sigue la propuesta de Anselin [-@Anselin2020local2] que usa inferencia por permutaciones condicionadas a través de la construcción una distribución empírica de referencia con arreglo a un proceso de permutaciones. Este enfoque es más robusto en la medida en que no asume una forma de distribución teórica preestablecida, lo que permite evaluar la significancia individual del índice de cada unidad territorial con base en dicha distribución.

### Fuentes de información

La base geográfica utilizada proviene del Marco Geoestadistico Nacional [@INEGI2020mgn] que contiene 2,469 áreas geoestadísticas municipales (municipios), para la que se construyó una matriz de pesos espaciales de tipo reina de orden 1, en tanto, la información del personal ocupado corresponde al año 2013 y proviene de los Censos Económicos de 2019 [@INEGIce2020].

## Desarrollo del método

### Obtención de los errores del modelo de regresión

Los paquetes utilizados son:

```{r include=FALSE}
library(sf)
library(rgeoda)
library(tidyverse)
```

La base de datos que contiene la información del empleo total y empleo por cadena de las 9 cadenas productivas identificadas con la MIP de 2013 es cargada con:

```{r}
# Base geográfica municipal
mun <- sf::st_read("Bases de datos/shp__mun_R/cluster_mun.shp")
```

Una vez cargada la base de datos espacial, `mun`, se estima una regresión del empleo total de cada municipio (`po`) sobre el empleo en el municipio de una de las cadenas identificadas. Para este ejemplo, el modelo se estima para la cadena metalmecánica (`pocl3`):

```{r}
mcl3 <- lm(data = mun, formula = po ~ pocl3)
```

Luego, se guardan los errores en una nueva variable, `res_cl3` y se incorporan a la base original:

```{r}
res_cl3<- mcl3[["residuals"]]
mun<-res_cl3 %>% cbind(mun)
colnames(mun)[1]<-'res_cl3'
mun <- mun %>% dplyr::select(CVEGEO, CVE_ENT, CVE_MUN, NOMGEO, po, res_cl3, geometry)
```

### Cálculo del estadístico de asociación espacial

Una vez que se tienen los errores de la regresión guardados como nueva variable en la base de datos original, se computa el estadístico $I_i$ con dicha variable, usando la estructura espacial indicada en la sección anterior (`q_1`).

```{r}
#Definición de la estructura espacial
q_1 <- rgeoda::queen_weights(mun)
#Crea un objeto de tipo LISA con la estructura espacial definida que contiene el estatistico Ii
Icl3 <- local_moran(w=q_1, df=mun["res_cl3"])
```

De acuerdo con el método, los municipios que integran los complejos industriales  de cada cadena productiva identificada son aquellos cuyo valor del indicador local de asociación espacial de Moran, $I_i$, es estadísticamente significativo al 5% y que además forman parte del agrupamiento Alto-Alto. Dichos municipios aparecen en el siguiente mapa de agrupamientos, junto con los municipios de las otras categorías. 

```{r}
### Mapa de cluster

#### Preliminares
##### Colores de cada unidad espacial según su categoría
lisa_colores <- rgeoda::lisa_colors(Icl3)
##### Etiquetas para cada categoría
lisa_etiq <- lisa_labels(Icl3)
##### Extracción de los valores que definen cada cluster con un 5% de significancia
lisa_clusters <- rgeoda::lisa_clusters(Icl3,cutoff = 0.05)
#### Construcción mapa de cluster con sf
plot(sf::st_geometry(mun), 
     col=sapply(lisa_clusters, function(x){return(lisa_colores[[x+1]])}), 
     border = "#333333", lwd=0.1)
title(main = "I Local de la metalmecánica")
legend('bottomleft', legend = lisa_etiq, fill = lisa_colores, border = "#eeeeee")

```

Además, es usual presentar los resultados del mapa de agrupamientos junto con el llamado mapa de significancia, que muestra la signficancia individual de cada municipio en diferentes niveles:


```{r}
### Mapa de significancia
#### Preliminares
#### Extracción de los valores p asociados a cada observación
lisa_p <- lisa_pvalues(Icl3)
#### Definición de las etiquetas de cada grupo de valores p
p_labels <- c("Not significant", "p <= 0.05", "p <= 0.01", "p <= 0.001")
#### Definición de los colores de cada grupo de valores p
p_colors <- c("#eeeeee", "#84f576", "#53c53c", "#348124")
# Mapa de significancia: construcción
plot(st_geometry(mun), 
     col=sapply(lisa_p, function(x){
       if (x <= 0.001) return(p_colors[4])
       else if (x <= 0.01) return(p_colors[3])
       else if (x <= 0.05) return (p_colors[2])
       else return(p_colors[1])
       }), 
     border = "#333333", lwd=0.2)
title(main = "Moran Local para la cadena metalmecánica")
legend('bottomleft', legend = p_labels, fill = p_colors, border = "#eeeeee")
```


La siguiente tabla resume los resultados del número de municipios para cada cadena productiva, tanto los que integran los complejos industriales como los que forman parte de la categoría Alto-Bajo

| Cadena productiva                        	| Municipios alto-alto 	| Municipios alto-bajo 	|
|------------------------------------------	|----------------------	|----------------------	|
| Metalmecánica.                           	| 71                   	| 11                   	|
| Química.                                 	| 63                   	| 24                   	|
| Eléctrico-electrónica.                   	| 81                   	| 8                    	|
| Textiles, confección y prendas de vestir 	| 75                   	| 7                    	|
| Construcción.                            	| 73                   	| 23                   	|
| Autotransportes.                         	| 69                   	| 11                   	|
| Papel e impresión.                       	| 79                   	| 6                    	|
| Plásticos y fibras sintéticas.           	| 64                   	| 18                   	|
| Muebles y productos de madera.           	| 59                   	| 14                   	|
: Tabla 1. Complejos industriales industriales, 2013








